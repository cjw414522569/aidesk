# AI Desktop Assistant (AIDesk)

一个功能强大的桌面AI助手，支持语音识别、智能对话、日程管理等多种功能。

语音唤醒使用Vosk小型中文模型：

下载地址：[vosk-model](https://alphacephei.com/vosk/models)

## 更新修复日志

### 2025.12.11
- 1.修复API响应错误处理
- 2.修改提醒输出和通知内容
- 3.修复AI对话框输入焦点问题
- 4.修复tts清洗数据过多
- 5.解决了TTS临时文件累积问题
- 6.修复了AI润色文本提取错误，确保TTS正确播报
- 7.提高了异常处理的精确性
- 8.避免了资源重复初始化
- 9.删除了重复的config模块导入
- 10.删除了重复的PushPlusService初始化
- 11.添加了缺失的sys模块导入
- 12.修复文件处理中的路径问题
- 13.修复语音识别中的资源路径问题
- 14.修复TTS服务中的pygame初始化问题
- 15.修复日程管理中的重复提醒逻辑
- 16.修复AI核心中的工具调用错误处理
- 17.添加缺失的异常处理
- 18.修复潜在的内存泄漏问题
- 19.修复打包后 vosk 模型路径找不到的问题
- 20.修复打包后的exe会重复运行

## 🌟 主要功能

### 🤖 AI对话
- 基于SiliconFlow API的智能对话
- 支持文本输入和语音输入
- 上下文感知的连续对话
- 支持多种AI模型配置

### 🎤 语音识别
- **离线识别**: 基于Vosk模型的本地语音识别
- **在线识别**: 支持多种在线语音API
- **语音唤醒**: 支持自定义唤醒词， hands-free操作
- **设备热插拔**: 麦克风拔插自动重连

### 📅 日程管理
- **重复日程**: 支持一次性、每日、每周、每月、每年重复
- **日历视图**: 完整的月历界面，有日程日期高亮显示
- **智能列表**: 默认显示当日日程，支持历史查看
- **视图切换**: 列表和日历模式一键切换

### 🔔 智能提醒
- 多种提醒方式：系统通知、语音播报
- 重复提醒：可设置重复次数和间隔
- PushPlus推送：支持远程推送通知

### 🎨 界面特性
- **现代化UI**: 基于PyQt5的现代化界面
- **主题支持**: 支持暗色和亮色主题
- **透明度调节**: 可调节窗口透明度
- **自定义颜色**: 支持自定义主题颜色

### ⚙️ 系统功能
- **热键支持**: 自定义快捷键操作
- **开机自启**: 支持开机自动启动
- **管理员权限**: 自动请求必要权限
- **多服务集成**: 集成多种实用服务

## 🚀 快速开始

### 环境要求
- Python 3.8+
- Windows 10/11
- 麦克风（推荐）

### 安装步骤

1. **克隆项目**
```bash
git clone https://github.com/cjw414522569/aidesk.git
cd aidesk
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

3. **配置API**
编辑 `config.py` 文件，设置你的API密钥：
```python
# SiliconFlow API配置
SILICONFLOW_API_KEY = "your_api_key_here"
SILICONFLOW_BASE_URL = "https://api.siliconflow.cn/v1"
```

4. **运行应用**
```bash
python main_qt.py
```

或者直接运行：
```bash
run.bat
```

## 📖 使用指南

### 基本操作

1. **语音对话**
   - 点击圆形按钮开始语音输入
   - 或使用快捷键 `Ctrl+1`
   - 说出唤醒词激活语音识别

2. **文本对话**
   - 右键点击圆形按钮
   - 选择"文本输入"
   - 或使用快捷键 `Ctrl+2`

3. **日程管理**
   - 右键菜单选择"显示/隐藏日程"
   - 点击"日历"按钮切换到日历视图
   - 点击日期查看该日日程

### 语音命令示例

```
"提醒我明天上午9点开会"
"设置一个每天早上8点的闹钟"
"今天天气怎么样"
"帮我打开记事本"
"播放音乐"
```

### 日程管理

#### 添加日程
```
"明天下午2点有个会议"
"下周三上午10点面试"
"每月1号交房租"
"每年生日提醒我"
```

#### 查看日程
- **列表视图**: 默认显示今日日程
- **历史视图**: 点击"历史"按钮查看过去日程
- **日历视图**: 点击"日历"按钮查看月历
- **日期选择**: 在日历中点击日期查看该日日程

## ⚙️ 配置说明

### API配置
- **SiliconFlow API**: 主要的AI对话API
- **天气API**: 天气查询服务
- **PushPlus Token**: 推送通知服务

### 语音配置
- **麦克风设备**: 选择输入音频设备
- **唤醒词**: 自定义语音唤醒词
- **语音模型**: 选择识别引擎

### 界面配置
- **主题模式**: 暗色/亮色主题
- **透明度**: 调节窗口透明度
- **主题颜色**: 自定义界面颜色

### 热键配置
- **语音控制**: 自定义语音识别快捷键
- **AI对话框**: 自定义对话窗口快捷键

## 🔧 开发说明

### 项目结构
```
aidesk/
├── core/                    # 核心功能模块
│   ├── ai_core_with_tools.py    # AI核心与工具集成
│   └── schedule_manager.py      # 日程管理器
├── gui/                     # 图形界面模块
│   └── gui_qt.py              # PyQt5主界面
├── services/                 # 服务模块
│   ├── voice_recognition.py      # 语音识别服务
│   ├── wake_word_detector.py     # 语音唤醒检测
│   ├── tts_service.py           # 语音合成服务
│   ├── weather_service.py       # 天气服务
│   └── ...                    # 其他服务
├── vosk-model-small-cn-0.22/ # 中文语音识别模型
├── config.py                 # 配置文件
├── main_qt.py               # 程序入口
└── requirements.txt           # 依赖包列表
```

### 技术栈
- **界面框架**: PyQt5
- **AI集成**: SiliconFlow API
- **语音识别**: Vosk + 在线API
- **语音合成**: TTS API
- **数据库**: SQLite (日程管理)
- **音频处理**: PyAudio

## 🐛 故障排除

### 常见问题

1. **语音识别不工作**
   - 检查麦克风是否连接
   - 确认麦克风权限
   - 检查音频驱动

2. **AI对话无响应**
   - 检查API密钥配置
   - 确认网络连接
   - 查看API配额

3. **唤醒词不响应**
   - 检查Vosk模型路径
   - 调整唤醒词清晰度
   - 检查环境噪音

4. **日程提醒不工作**
   - 检查系统通知设置
   - 确认TTS服务配置
   - 检查重复提醒设置

### 日志调试
应用运行时会输出详细日志，包括：
- `[启动]`: 启动信息
- `[唤醒词]`: 语音唤醒相关
- `[语音识别]`: 语音识别结果
- `[AI回复]`: AI对话响应
- `[日程]`: 日程管理操作

## 📄 许可证

本项目采用 MIT 许可证，详情请查看 LICENSE 文件。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

### 贡献指南
1. Fork 本项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 📞 更新日志

### v1.0.0 (2024-12-10)
- ✨ 新增重复日程支持（每日/每周/每月/每年）
- ✨ 新增日历视图界面
- ✨ 新增日程日期高亮显示
- ✨ 优化按钮交互，一次点击生效
- ✨ 新增麦克风热插拔自动重连
- ✨ 优化界面主题和用户体验
- 🐛 修复音频设备检测问题
- 🐛 修复按钮变灰问题
- 🐛 抑制pygame警告信息

## 📞 联系方式

- **项目地址**: https://github.com/cjw414522569/aidesk
- **问题反馈**: 请在GitHub提交Issue
- **功能建议**: 欢迎提交Pull Request

---

⭐ 如果这个项目对你有帮助，请给个Star支持一下！
